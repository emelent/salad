<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fancy Slider</title>
  <!--<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>-->
  <!--<script src="/lib/babel.min.js"></script>-->
  <style>
  .fs-container{
    margin-top: 100px;
    text-align: center;
  }

  .fs-container__box{
    display: inline-block;
    position: relative;
    z-index: 1;

    height: 100px;
    width: 200px;

    border: 3px solid #000;
    background: plum;
    transition: all 0.3s cubic-bezier(.25,.8,.25,1);
  }
  </style>
</head>
<body>

  <div class="fs-container" id="slider">
    <div class="fs-container__box">1</div>
    <div class="fs-container__box">2</div>
    <div class="fs-container__box">3</div>
    <div class="fs-container__box">4</div>
    <div class="fs-container__box">5</div>
  </div>
<script>

"strict";
var FancySlider = (function(){
  "use strict";
  function FancySlider(el){
    this.element = el;
    this.focus = Math.floor(el.children.length/2);
    this.animateTimer = null;
    this.createClickEvents();
    this.updateChildren();
  }

  FancySlider.prototype.createClickEvents = function(){
    var that = this;
    Array.from(this.element.children).forEach(function(el, i){
      el.onclick = function(){
        that.animatedShift(-(that.focus - i));
      };
    });
  };
  
  FancySlider.prototype.getItemCount = function(){
    return this.element.childElementCount;
  };

  FancySlider.prototype.shiftRight = function(n){
    n = Math.abs(n);
    if(this.focus + n > this.getItemCount()-1)
      return;
    this.focus = (this.focus + n) % this.getItemCount();
    console.log('focusing on element => ', this.focus + 1);
    this.updateChildren();
  };

  FancySlider.prototype.shiftLeft = function (n){
    n = Math.abs(n);
    if(this.focus - n < 0)
      return;
    console.log('focusing on element => ', this.focus);
    this.focus = (this.focus - n) % this.getItemCount();
    if(this.focus < 0)
      this.focus = 0;
    this.updateChildren();
  };

  FancySlider.prototype.getDistFromFocus = function(i){
    return Math.abs(i - this.focus);
  };

  FancySlider.prototype.shift = function(n){
    if(n < 0)
      this.shiftLeft(n);
    else
      this.shiftRight(n);
  };

  FancySlider.prototype.animatedShift = function(n){
    if(this.animateTimer !== null)
      return;
    var len = Math.abs(n);
    var that = this;
    this.animatedTimer = setInterval(function () {
        if(len <= 1){
          clearInterval(that.animatedTimer);
          that.animatedTimer = null;
        }

        if(n < 0) that.shiftLeft(1);
        else that.shiftRight(1);
        len --;
    }, 300);
  };

  FancySlider.prototype.updateChildren = function(){
    var factor = 0.8;
    var that = this;
    Array.from(this.element.children).forEach(function(el, i){
      var dist = that.getDistFromFocus(i);
      var scale = (dist == 0)? 1.3:Math.pow(0.8, dist);
      var margin = (dist > 1)? -100:0;

      //update styles
      el.style.transform = 'scale(' + scale + ')';
      el.style.zIndex = Math.floor(that.getItemCount() / 2) - dist;
      el.style.margin = margin + 'px';
    });
  }

  return FancySlider;
}());

var fancy = new FancySlider(document.getElementById('slider'));
</script>
</body>
</html>
